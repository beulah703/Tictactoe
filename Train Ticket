<!DOCTYPE html> 
<html>
<title>Train Booking</title>
<head>
</head>
<body>
<h1>Book Bus Tickets Online</h1>
		<form action="#" method="GET">
			<label for="source">From</label>
			<input type="text" id="source" name="source" placeholder="Enter Source City">
			<label for="destination">To</label>
			<input type="text" id="destination" name="destination" placeholder="Enter Destination City">
			<label for="date">Journey Date</label>
			<input type="date" id="date" name="date">
			<label for="class">Class</label>
			<select id="class" name="class">
				<option value="1A">First AC</option>
				<option value="2A">Second AC</option>
				<option value="3A">Third AC</option>
				<option value="SL">Sleeper</option>
			</select>
			<button type="submit">Search Buses</button>
		</form>
		
		<form>
  <h2>Passenger Details</h2>
  <table>
    <thead>
      <tr>
        <th>Passenger Name</th>
        <th>Age</th>
        <th>Gender</th>
       
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" name="passenger1_name" placeholder="Passenger 1 Name"></td>
        <td><input type="number" name="passenger1_age" placeholder="Passenger 1 Age"></td>
        <td>
          <label><input type="radio" name="passenger1_gender" value="Male">Male</label>
          <label><input type="radio" name="passenger1_gender" value="Female">Female</label>
        </td>
       
      </tr>
      <tr>
        <td><input type="text" name="passenger2_name" placeholder="Passenger 2 Name"></td>
        <td><input type="number" name="passenger2_age" placeholder="Passenger 2 Age"></td>
        <td>
          <label><input type="radio" name="passenger2_gender" value="Male">Male</label>
          <label><input type="radio" name="passenger2_gender" value="Female">Female</label>
        </td>
      
      </tr>
      <tr>
        <td><input type="text" name="passenger3_name" placeholder="Passenger 3 Name"></td>
        <td><input type="number" name="passenger3_age" placeholder="Passenger 3 Age"></td>
        <td>
          <label><input type="radio" name="passenger3_gender" value="Male">Male</label>
          <label><input type="radio" name="passenger3_gender" value="Female">Female</label>
        </td>
       
      </tr>
      <tr>
        <td><input type="text" name="passenger3_name" placeholder="Passenger 3 Name"></td>
        <td><input type="number" name="passenger3_age" placeholder="Passenger 3 Age"></td>
        <td>
          <label><input type="radio" name="passenger3_gender" value="Male">Male</label>
          <label><input type="radio" name="passenger3_gender" value="Female">Female</label>
        </td>
       
      </tr>
       <tr>
        <td><input type="text" name="passenger4_name" placeholder="Passenger 4 Name"></td>
        <td><input type="number" name="passenger3_age" placeholder="Passenger 4 Age"></td>
        <td>
          <label><input type="radio" name="passenger5_gender" value="Male">Male</label>
          <label><input type="radio" name="passenger5_gender" value="Female">Female</label>
        </td>
       
      </tr>


</body>
</html>

@WebServlet("/train-search")
public class TrainSearchServlet extends HttpServlet {
    private TrainDAO trainDAO;

    @Override
    public void init() throws ServletException {
        super.init();
        try {
            trainDAO = new TrainDAO();
        } catch (SQLException e) {
            throw new ServletException(e);
        }
    }

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // Display the train search form
        RequestDispatcher dispatcher = request.getRequestDispatcher("/train-search.jsp");
        dispatcher.forward(request, response);
    }

    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // Retrieve the source and destination from the form submission
        String source = request.getParameter("source");
        String destination = request.getParameter("destination");

        // Query the database for trains between the source and destination
        List<Train> trains;
        try {
            trains = trainDAO.getTrainsBySourceAndDestination(source, destination);
        } catch (SQLException e) {
            throw new ServletException(e);
        }

        // Pass the list of trains to the JSP page to be displayed
        request.setAttribute("trains", trains);
        RequestDispatcher dispatcher = request.getRequestDispatcher("/train-search-results.jsp");
        dispatcher.forward(request, response);
    }
}



<html>
<head>
    <title>Train Search</title>
</head>
<body>
    <h1>Train Search</h1>
    <form method="post" action="/train-search">
        <label for="source">Source:</label>
        <input type="text" id="source" name="source" required>
        <br>
        <label for="destination">Destination:</label>
        <input type="text" id="destination" name="destination" required>
        <br>
        <button type="submit">Search</button>
    </form>
</body>
</html>



<html>
<head>
    <title>Train Search Results</title>
</head>
<body>
    <h1>Train Search Results</h1>
    <table>
        <thead>
            <tr>
                <th>Train ID</th>
                <th>Train Name</th>
                <th>Source</th>
                <th>Destination</th>
                <th>Departure Time</th>
                <th>Arrival Time</th>
            </tr>
        </thead>
        <tbody>
            <c:forEach items="${trains}" var="train">
                <tr>
                    <td>${train.trainId}</td>
                    <td>${train.trainName}</td>
                    <td>${train.source}</td>
                    <td>${train.destination}</td>
                    <td>${train.departureTime}</td>
                    <td>${train.arrivalTime}</td>
                </tr>
            </c:forEach>
        </tbody>
    </table>
</body>
</html>

create table sow_stn( stn_code char(10) not null,  stn_name varchar(100), primary key(stn_code))
drop table sow_stn;

create table sow_stn_dis(fst_code char(10), tst_code char(10), std_dist int )
ALTER TABLE sow_stn_dis ADD CONSTRAINT fk_fst_customers FOREIGN KEY (fst_code) REFERENCES sow_stn (stn_code);
ALTER TABLE sow_stn_dis ADD CONSTRAINT fk_tst_customers FOREIGN KEY (tst_code) REFERENCES sow_stn (stn_code);

create table sow_trains (tr_no int primary key, tr_name varchar(100), tr_type char(10), tr_start char(10), tr_end char(10), tr_surcharge numeric)
ALTER TABLE sow_trains  ADD CONSTRAINT fk_tr_start FOREIGN KEY (tr_start) REFERENCES sow_stn (stn_code);
ALTER TABLE sow_trains  ADD CONSTRAINT fk_tr_end FOREIGN KEY (tr_end) REFERENCES sow_stn (stn_code);
Alter table sow_trains add column trn_status char(10)

create table sow_trn_stations (tr_no int, stn_code char(10) ,trs_index INT, Primary key (tr_no, stn_code));
create table sow_tr_fares(far_dist int, far_basefare numeric)
create table tn_tvl_classes(tr_no int, tr_tvl_class char(10) , far_factor NUMERIC, primary key (tr_no, tr_tvl_class))
create table sow_tickets(tk_id int primary key, pnr_no int, tk_tr_no int, tk_tr_date date, tk_from char(10), tk_to char(10), tk_tr_class char(3), tk_totalfare numeric)
ALTER TABLE sow_tickets  ADD CONSTRAINT fk_tr_tno FOREIGN KEY (tk_tr_no) REFERENCES sow_trains (tr_no);
ALTER TABLE sow_tickets ADD CONSTRAINT fk_tk_from FOREIGN KEY (tk_from) REFERENCES sow_stn (stn_code);
ALTER TABLE sow_tickets  ADD CONSTRAINT fk_tk_to FOREIGN KEY (tk_to) REFERENCES sow_stn (stn_code);
create table sow_pass (tk_id int, tk_pindex int, tkt_name varchar(100), tkt_age int, tkt_gender char(10), tkt_amt numeric, primary key(tk_id, tk_pindex))
ALTER TABLE sow_pass  ADD CONSTRAINT fk_tk_id FOREIGN KEY (tk_id) REFERENCES sow_tickets (tk_id);


insert into sow_stn values('ND','NEW DELHI');
insert into sow_stn values('KNP','KANPUR');
insert into sow_stn values ('PRG','PRYAGRA JUNCTION');    
insert into sow_stn values ('UPJ', 'UPADHYAYA');
insert into sow_stn values('HJL','HIJILI');
insert into sow_stn values('CTK','CUTTACK');
insert into sow_stn values('BBR','BHUBANESWAR');
insert into sow_stn values('HYD','HYDERABAD'); 
insert into sow_stn values('SND','SECUNDERABAD'); 
insert into sow_stn values('WGR','WARANGAL'); 
insert into sow_stn values('KMM','KAMAM');
insert into sow_stn values('VJY','VIJAYAWADA'); 
insert into sow_stn values('ELU','ELLURU');
insert into sow_stn values('TPJ','TADEPALLI GUDEM'); 
insert into sow_stn values('RJY','RAJAHMUNDRY'); 
insert into sow_stn values('ANV','ANNAVARAM'); 
insert into sow_stn values('TUN','TUNI');
insert into sow_stn values('AKP', 'ANAKAPALLI'); 
insert into sow_stn values('VSKP','VISAKHAPATNAM'); 
insert into sow_stn values('NZV', 'NUZVEEDU'); 
insert into sow_stn values('BHD','BHEMADOLU'); 
insert into sow_stn values('NDV', 'NIDAVOLU'); 
insert into sow_stn values('DVP','DVAARAPUDI' ); 
insert into sow_stn values('DUV','DUVVADA')   ; 
insert into sow_stn values('TRP','TIRUPATHI'); 
insert into sow_stn values('KDP','KADAPA'); 
insert into sow_stn values('KDR','KODURU'); 
insert into sow_stn values('PKL','PAKALA'); 
insert into sow_stn values('KDR','KADIR'); 
insert into sow_stn values('ANT','ANANTHAPURAM'); 
insert into sow_stn values('MBB','MAHABOOB NAGAR');

insert into sow_stn_dis values('ND','KNP', 440);
insert into sow_stn_dis values('KNP','PRG', 194);
insert into sow_stn_dis values('PRJ','UPJ',152 );
insert into sow_stn_dis values('UPJ','HJL',698 );
insert into sow_stn_dis values('HJL','CTK', 318 );
insert into sow_stn_dis values('CTK','BBR',28 );
insert into sow_stn_dis values('HYD','SND',7);
insert into sow_stn_dis values('SND','WGL',142 );
insert into sow_stn_dis values('WGL','KMM',108 );
insert into sow_stn_dis values('KMM','VJY', 99 );
insert into sow_stn_dis values('VJY','ELU',  59);
insert into sow_stn_dis values('ELU','TPJ', 48 );
insert into sow_stn_dis values('TPJ','RJY',42  );
insert into sow_stn_dis values('RJY','ANV',87  );
insert into sow_stn_dis values('ANV','TUN',17  );
insert into sow_stn_dis values('TUN','AKP',64  );
insert into sow_stn_dis values('AKP','VSKP',33  );

insert into sow_stn_dis values('TRP','PKL',41  );
insert into sow_stn_dis values('PKL','KDR',161  );
insert into sow_stn_dis values('KDR','ANT',102  );
insert into sow_stn_dis values('ANT','MBB',297  );
insert into sow_stn_dis values('MBB','HYD',106  );

insert into sow_stn_dis values('KDP','KDR',84  );
insert into sow_stn_dis values('KDR','TRP',51  );
insert into sow_stn_dis values('TRP','VJY',386  );
insert into sow_stn_dis values('VJY','NZV',41  );
insert into sow_stn_dis values('NZV','ELU', 19 );
insert into sow_stn_dis values('ELU','TPJ',48  );
insert into sow_stn_dis values('TPJ','NDV',20  );
insert into sow_stn_dis values('NDV','DRP',42  );
insert into sow_stn_dis values('DRP','PTP',42  );
insert into sow_stn_dis values('PTP','ANV',25  );

insert into sow_stn_dis values('ANK','DUV', 15 );
insert into sow_stn_dis values('DUV','VSKP',  18);


insert into sow_trains values(22824,'RAJDHANI', 'EXPR','ND','BBR',20 );
insert into sow_trains values(12788,'GODAVARI', 'GEN','HYD','VJY',15 );
insert into sow_trains values(12774,'SHALIMAR', 'SPFST/AC','SND','VSKP',40 );
insert into sow_trains values(17487,'TIRUMALA', 'EXPR','KDP','HYD', 23);
insert into sow_trains values(07605,'AKOLA', 'SPCL','TRP','HYD',30 );
UPDATE SOW_TRAINS SET TR_START='SND' WHERE TR_NO=12774
UPDATE SOW_TRAINS SET TRN_STATUS='RN' WHERE TR_NO=12774
UPDATE SOW_TRAINS SET TRN_STATUS='RN' WHERE TR_NO=22824
UPDATE SOW_TRAINS SET TRN_STATUS='STP' WHERE TR_NO=12788
UPDATE SOW_TRAINS SET TRN_STATUS='RN' WHERE TR_NO=17487
insert into sow_trn_sTATIONS(tr_no , stn_code, trs_index  ) values(22824,'ND',0);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(22824,'KNP',1);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(22824,'PRG',2);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(22824,'UPJ',3);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(22824,'HJL',4);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(22824,'CTK',5);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(22824,'BBR',6);
                                                                  
insert into sow_trn_sTATIONS(tr_no , stn_code,trs_index  ) values(12728,'HYD',0);
insert into sow_trn_sTATIONS(tr_no , stn_code,trs_index  ) values(12728,'SND',1);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12728,'WGL',2);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12728,'KMM',3);
insert into sow_trn_sTATIONS(tr_no , stn_code,trs_index ) values(12728,'VJY',4);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12728,'ELU',5);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12728,'TPJ',6);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12728,'RJY',7);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12728,'ANV',8);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12728,'TUN',9);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index  ) values(12728,'ANK',10);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12728,'VSKP',11);
insert into sow_trn_sTATIONS(tr_no , stn_code,trs_index  ) values(12774,'SND',0);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12774,'RJY',2);
insert into sow_trn_sTATIONS(tr_no , stn_code,trs_index  ) values(12774,'WGL',1);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(12774,'VSKP',3);
insert into sow_trn_sTATIONS(tr_no , stn_code,trs_index  ) values(07605,'TRP',0);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(07605,'PKL',1);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(07605,'KDR',2);
insert into sow_trn_sTATIONS(tr_no , stn_code,trs_index  ) values(07605,'ANT',3);
insert into sow_trn_sTATIONS(tr_no , stn_code,trs_index  ) values(07605,'MBB',4);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(07605,'HYD',5);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'KDP',1);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'KDR',2);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'TRP',3);
insert into sow_trn_sTATIONS(tr_no , stn_code,trs_index  ) values(17487,'VJY',4);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'NZV',5);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'NDV',8);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index  ) values(17487,'PTP',11);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'TUN',13);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'ANV',12);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'DRP',10);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'TPJ',7);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'ANK',14);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'DUV',15);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'RJY',9);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'ELU',6);
insert into sow_trn_sTATIONS(tr_no , stn_code ,trs_index ) values(17487,'VSKP',16);

INSERT INTO tn_tvl_classes VALUES(22824,'1AC',1.7);
INSERT INTO tn_tvl_classes VALUES(22824,'2AC',2.2);
INSERT INTO tn_tvl_classes VALUES(22824,'3AC',3.6);
INSERT INTO tn_tvl_classes VALUES(22824,'SLP',4.8);

INSERT INTO tn_tvl_classes VALUES(12728,'1AC',1.7);
INSERT INTO tn_tvl_classes VALUES(12728,'2AC',2.2);
INSERT INTO tn_tvl_classes VALUES(12728,'3AC',3.6);
INSERT INTO tn_tvl_classes VALUES(12728,'SLP',4.8);

INSERT INTO tn_tvl_classes VALUES(12774,'1AC',1.7);
INSERT INTO tn_tvl_classes VALUES(12774,'2AC',2.2);
INSERT INTO tn_tvl_classes VALUES(12774,'3AC',3.6);

INSERT INTO tn_tvl_classes VALUES(07605,'1AC',1.7);
INSERT INTO tn_tvl_classes VALUES(07605,'2AC',2.2);
INSERT INTO tn_tvl_classes VALUES(07605,'3AC',3.6);


INSERT INTO tn_tvl_classes VALUES(17487,'1AC',1.7);
INSERT INTO tn_tvl_classes VALUES(17487,'2AC',2.2);
INSERT INTO tn_tvl_classes VALUES(17487,'3AC',3.6);
INSERT INTO tn_tvl_classes VALUES(17487,'SLP',4.4);


INSERT INTO sow_tr_fares VALUES(10,12);
INSERT INTO sow_tr_fares VALUES(50,22);
INSERT INTO sow_tr_fares VALUES(100,40);
INSERT INTO sow_tr_fares VALUES(150,68);
INSERT INTO sow_tr_fares VALUES(200,75);
INSERT INTO sow_tr_fares VALUES(500,90);
INSERT INTO sow_tr_fares VALUES(1000,125);

SELECT * from sow_stn;
SELECT * from sow_stn_dis;
SELECT * from sow_trains;
SELECT * from sow_trn_stations;
SELECT * from sow_tr_fares;
SELECT * from sow_tickets;
SELECT * from sow_pass;
SELECT * from tn_tvl_classes;

drop table sow_trn_stations;
drop table sow_pass;
drop table sow_tickets;
drop table tn_tvl_classes;
drop table sow_tr_fares;
drop table sow_trains;
drop table sow_stn_dis;

CREATE or replace FUNCTION TicketsInsert1(tk_tr_no integer,tk_from char(10), tk_to char(10),tk_tr_class char(10))
  RETURNS void AS
  $BODY$
  declare 
--   ts Timestamp;
--   y text;
--   mo text;
--   d text;
--   h text;
--   mi text;
--   s text;
--   td int;
rv float;
      BEGIN
      rv:= random();
       rv:= (rv*7657656 );        
 
-- 	 ts := Current_timestamp;       
-- 	y := extract(year from ts):: text;
--     mo := extract(month from ts):: text;
--     d := extract(day from ts):: text;
--     h := extract(hour from ts):: text;
--     mi := extract(minute from ts):: text;
--     s := extract(second from ts):: text;
-- 	        s:= y+mo+d+h+mi+s;
--             td := cast(s as integer);
        
        INSERT INTO sow_tickets(tk_id,pnr_no,tk_tr_no ,tk_tr_date,tk_from , tk_to ,tk_tr_class )
        VALUES(rv,rv+1,tk_tr_no ,current_date,tk_from , tk_to ,tk_tr_class);
     
      
      END;
  $BODY$
  LANGUAGE 'plpgsql' 
  

  select TicketsInsert1(07605,'HYD','VSKP','1AC')


import java.io.*;
import java.sql.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class RouteDropdownServlet extends HttpServlet {
  
  public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    
    // Set up database connection
    String url = "jdbc:mysql://localhost:3306/train_app";
    String user = "username";
    String password = "password";
    Connection conn = null;
    PreparedStatement stmt = null;
    ResultSet rs = null;
    
    try {
      Class.forName("com.mysql.jdbc.Driver");
      conn = DriverManager.getConnection(url, user, password);
      
      // Prepare SQL statement to retrieve distinct from_location and to_location values
      String sql = "SELECT DISTINCT from_location, to_location FROM train_routes";
      stmt = conn.prepareStatement(sql);
      rs = stmt.executeQuery();
      
      // Retrieve from_location and to_location values from the ResultSet
      List<String> fromLocations = new ArrayList<>();
      List<String> toLocations = new ArrayList<>();
      while (rs.next()) {
        String fromLocation = rs.getString("from_location");
        String toLocation = rs.getString("to_location");
        fromLocations.add(fromLocation);
        toLocations.add(toLocation);
      }
      
      // Set response content type
      response.setContentType("text/html");
      
      // Write out the from_location and to_location values as dropdown buttons
      PrintWriter out = response.getWriter();
      out.println("<html>");
      out.println("<head><title>Select Route</title></head>");
      out.println("<body>");
      out.println("<form>");
      out.println("<label for='from_location'>From:</label>");
      out.println("<select name='from_location' id='from_location'>");
      for (String fromLocation : fromLocations) {
        out.println("<option value='" + fromLocation + "'>" + fromLocation + "</option>");
      }
      out.println("</select>");
      out.println("<br/><br/>");
      out.println("<label for='to_location'>To:</label>");
      out.println("<select name='to_location' id='to_location'>");
      for (String toLocation : toLocations) {
        out.println("<option value='" + toLocation + "'>" + toLocation + "</option>");
      }
      out.println("</select>");
      out.println("<br/><br/>");
      out.println("<input type='submit' value='Search'/>");
      out.println("</form>");
      out.println("</body></html>");
    } catch (ClassNotFoundException e) {
      e.printStackTrace();
    } catch (SQLException e) {
      e.printStackTrace();
    } finally {
      // Close database resources
      try { rs.close(); } catch (Exception e) { /* ignored */ }
      try { stmt.close(); } catch (Exception e) { /* ignored */ }
      try { conn.close(); } catch (Exception e) { /* ignored */ }
    }
    
  }
  
}
